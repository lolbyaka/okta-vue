{"version":3,"file":"okta-vue.esm.js","sources":["../../src/okta-vue.ts","../../src/components/LoginCallback.vue"],"sourcesContent":["/*!\n * Copyright (c) 2017-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport _Vue from 'vue'\nimport VueRouter from 'vue-router'\nimport { AuthSdkError, OktaAuth, AuthState, toRelativeUrl } from '@okta/okta-auth-js'\nimport { OktaVueOptions, OnAuthRequiredFunction } from './types'\n\n// constants are defined in webpack.config.js\ndeclare const PACKAGE: {\n  name: string;\n  version: string;\n}\n\nlet _oktaAuth: OktaAuth\nlet _onAuthRequired: OnAuthRequiredFunction\nlet _router: VueRouter\nlet originalUriTracker: string\n\nconst guardSecureRoute = async (authState: AuthState) => {\n  if (!authState.isAuthenticated) {\n    _oktaAuth.setOriginalUri(originalUriTracker)\n    if (_onAuthRequired) {\n      await _onAuthRequired(_oktaAuth)\n    } else {\n      await _oktaAuth.signInWithRedirect()\n    }\n  }\n}\n\nconst AuthStateMixin = _Vue.extend({\n  data () {\n    return {\n      authState: _oktaAuth.authStateManager.getAuthState()\n    }\n  },\n  created () {\n    // subscribe to the latest authState\n    _oktaAuth.authStateManager.subscribe(this.$_oktaVue_handleAuthStateUpdate)\n    if (!_oktaAuth.token.isLoginRedirect()) {\n      // trigger an initial change event to make sure authState is latest\n      _oktaAuth.authStateManager.updateAuthState()\n    }\n  },\n  beforeDestroy () {\n    _oktaAuth.authStateManager.unsubscribe(this.$_oktaVue_handleAuthStateUpdate)\n  },\n  // private property naming convention follows\n  // https://vuejs.org/v2/style-guide/#Private-property-names-essential\n  methods: {\n    // eslint-disable-next-line @typescript-eslint/camelcase\n    async $_oktaVue_handleAuthStateUpdate (authState: AuthState) {\n      this.authState = Object.assign(this.authState, authState)\n    }\n  }\n})\n\nexport const NavigationGuardMixin = _Vue.extend({\n  beforeCreate () {\n    // assign router for the default restoreOriginalUri callback\n    _router = this.$router\n  },\n  // \"beforeRouteEnter\" does NOT have access to `this` component instance\n  async beforeRouteEnter (to, from, next) {\n    if (to.matched.some(record => record.meta.requiresAuth)) {\n      // track the originalUri for guardSecureRoute\n      originalUriTracker = to.fullPath\n\n      // subscribe to authState change to protect secure routes when authState change\n      // all secure routes should subscribe before enter the route\n      _oktaAuth.authStateManager.subscribe(guardSecureRoute)\n\n      // guard the secure route based on the authState when enter\n      const isAuthenticated = await _oktaAuth.isAuthenticated()\n      if (!isAuthenticated) {\n        const authState = _oktaAuth.authStateManager.getAuthState()\n        await guardSecureRoute(authState)\n      } else {\n        next()\n      }\n    } else {\n      next()\n    }\n  },\n  beforeRouteLeave (to, from, next) {\n    _oktaAuth.authStateManager.unsubscribe(guardSecureRoute)\n    next()\n  }\n})\n\nfunction install (Vue: typeof _Vue, {\n  oktaAuth,\n  onAuthRequired\n} = {} as OktaVueOptions) {\n  if (!oktaAuth) {\n    throw new AuthSdkError('No oktaAuth instance passed to OktaVue.')\n  }\n\n  // customize user agent\n  oktaAuth.userAgent = `${PACKAGE.name}/${PACKAGE.version} ${oktaAuth.userAgent}`\n\n  // add default restoreOriginalUri callback\n  if (!oktaAuth.options.restoreOriginalUri) {\n    oktaAuth.options.restoreOriginalUri = async (oktaAuth: OktaAuth, originalUri: string) => {\n      // If a router is available, provide a default implementation\n      if (_router) {\n        const path = toRelativeUrl(originalUri, window.location.origin)\n        _router.replace({ path })\n        return\n      }\n    }\n  }\n\n  _oktaAuth = oktaAuth\n  _onAuthRequired = onAuthRequired\n\n  Vue.mixin(AuthStateMixin)\n  Vue.mixin(NavigationGuardMixin)\n\n  // add oktaAuth instance to Vue\n  Vue.prototype.$oktaAuth = oktaAuth\n}\n\nexport default { install }\n","/*!\n * Copyright (c) 2017-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\n\n<script lang=\"ts\">\nimport Vue from 'vue'\n\nexport default Vue.extend({\n  name: 'LoginCallback',\n  async beforeMount () {\n    await this.$oktaAuth.handleLoginRedirect()\n  },\n  render() { \n    // typescript not allow empty render function, here's the workaround for renderless component\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    return this.$scopedSlots.default && this.$scopedSlots.default({}) as any\n  }\n})\n</script>\n"],"names":["Vue"],"mappings":"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"}