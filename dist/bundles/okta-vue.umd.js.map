{"version":3,"file":"okta-vue.umd.js","sources":["../../src/okta-vue.ts","../../src/components/LoginCallback.vue"],"sourcesContent":["/*!\n * Copyright (c) 2017-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport _Vue from 'vue'\nimport VueRouter from 'vue-router'\nimport { AuthSdkError, OktaAuth, AuthState, toRelativeUrl } from '@okta/okta-auth-js'\nimport { OktaVueOptions, OnAuthRequiredFunction } from './types'\n\n// constants are defined in webpack.config.js\ndeclare const PACKAGE: {\n  name: string;\n  version: string;\n}\n\nlet _oktaAuth: OktaAuth\nlet _onAuthRequired: OnAuthRequiredFunction\nlet _router: VueRouter\nlet originalUriTracker: string\n\nconst guardSecureRoute = async (authState: AuthState) => {\n  if (!authState.isAuthenticated) {\n    _oktaAuth.setOriginalUri(originalUriTracker)\n    if (_onAuthRequired) {\n      await _onAuthRequired(_oktaAuth)\n    } else {\n      await _oktaAuth.signInWithRedirect()\n    }\n  }\n}\n\nconst AuthStateMixin = _Vue.extend({\n  data () {\n    return {\n      authState: _oktaAuth.authStateManager.getAuthState()\n    }\n  },\n  created () {\n    // subscribe to the latest authState\n    _oktaAuth.authStateManager.subscribe(this.$_oktaVue_handleAuthStateUpdate)\n    if (!_oktaAuth.token.isLoginRedirect()) {\n      // trigger an initial change event to make sure authState is latest\n      _oktaAuth.authStateManager.updateAuthState()\n    }\n  },\n  beforeDestroy () {\n    _oktaAuth.authStateManager.unsubscribe(this.$_oktaVue_handleAuthStateUpdate)\n  },\n  // private property naming convention follows\n  // https://vuejs.org/v2/style-guide/#Private-property-names-essential\n  methods: {\n    // eslint-disable-next-line @typescript-eslint/camelcase\n    async $_oktaVue_handleAuthStateUpdate (authState: AuthState) {\n      this.authState = Object.assign(this.authState, authState)\n    }\n  }\n})\n\nexport const NavigationGuardMixin = _Vue.extend({\n  beforeCreate () {\n    // assign router for the default restoreOriginalUri callback\n    _router = this.$router\n  },\n  // \"beforeRouteEnter\" does NOT have access to `this` component instance\n  async beforeRouteEnter (to, from, next) {\n    if (to.matched.some(record => record.meta.requiresAuth)) {\n      // track the originalUri for guardSecureRoute\n      originalUriTracker = to.fullPath\n\n      // subscribe to authState change to protect secure routes when authState change\n      // all secure routes should subscribe before enter the route\n      _oktaAuth.authStateManager.subscribe(guardSecureRoute)\n\n      // guard the secure route based on the authState when enter\n      const isAuthenticated = await _oktaAuth.isAuthenticated()\n      if (!isAuthenticated) {\n        const authState = _oktaAuth.authStateManager.getAuthState()\n        await guardSecureRoute(authState)\n      } else {\n        next()\n      }\n    } else {\n      next()\n    }\n  },\n  beforeRouteLeave (to, from, next) {\n    _oktaAuth.authStateManager.unsubscribe(guardSecureRoute)\n    next()\n  }\n})\n\nfunction install (Vue: typeof _Vue, {\n  oktaAuth,\n  onAuthRequired\n} = {} as OktaVueOptions) {\n  if (!oktaAuth) {\n    throw new AuthSdkError('No oktaAuth instance passed to OktaVue.')\n  }\n\n  // customize user agent\n  oktaAuth.userAgent = `${PACKAGE.name}/${PACKAGE.version} ${oktaAuth.userAgent}`\n\n  // add default restoreOriginalUri callback\n  if (!oktaAuth.options.restoreOriginalUri) {\n    oktaAuth.options.restoreOriginalUri = async (oktaAuth: OktaAuth, originalUri: string) => {\n      // If a router is available, provide a default implementation\n      if (_router) {\n        const path = toRelativeUrl(originalUri, window.location.origin)\n        _router.replace({ path })\n        return\n      }\n    }\n  }\n\n  _oktaAuth = oktaAuth\n  _onAuthRequired = onAuthRequired\n\n  Vue.mixin(AuthStateMixin)\n  Vue.mixin(NavigationGuardMixin)\n\n  // add oktaAuth instance to Vue\n  Vue.prototype.$oktaAuth = oktaAuth\n}\n\nexport default { install }\n","/*!\n * Copyright (c) 2017-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\n\n<script lang=\"ts\">\nimport Vue from 'vue'\n\nexport default Vue.extend({\n  name: 'LoginCallback',\n  async beforeMount () {\n    await this.$oktaAuth.handleLoginRedirect()\n  },\n  render() { \n    // typescript not allow empty render function, here's the workaround for renderless component\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    return this.$scopedSlots.default && this.$scopedSlots.default({}) as any\n  }\n})\n</script>\n"],"names":["_oktaAuth","_onAuthRequired","_router","originalUriTracker","guardSecureRoute","authState","isAuthenticated","setOriginalUri","_a","signInWithRedirect","AuthStateMixin","_Vue","extend","data","authStateManager","getAuthState","created","subscribe","this","$_oktaVue_handleAuthStateUpdate","token","isLoginRedirect","updateAuthState","beforeDestroy","unsubscribe","methods","Object","assign","NavigationGuardMixin","beforeCreate","$router","beforeRouteEnter","to","from","next","matched","some","record","meta","requiresAuth","fullPath","beforeRouteLeave","install","Vue","_b","oktaAuth","onAuthRequired","AuthSdkError","userAgent","options","restoreOriginalUri","originalUri","path","toRelativeUrl","window","location","origin","replace","mixin","prototype","$oktaAuth","name","beforeMount","handleLoginRedirect","render","$scopedSlots","default"],"mappings":"wZAuBIA,EACAC,EACAC,EACAC;;;;;;;;;;;;;;;;;;;;;;;;;OAEJ,IAAMC,EAAmB,SAAOC,sGACzBA,EAAUC,uBACbN,EAAUO,eAAeJ,GACrBF,KACIA,EAAgBD,yBAAtBQ,sBAEA,SAAMR,EAAUS,6BAAhBD,4CAKAE,EAAiBC,UAAKC,OAAO,CACjCC,gBACE,MAAO,CACLR,UAAWL,EAAUc,iBAAiBC,iBAG1CC,mBAEEhB,EAAUc,iBAAiBG,UAAUC,KAAKC,iCACrCnB,EAAUoB,MAAMC,mBAEnBrB,EAAUc,iBAAiBQ,mBAG/BC,yBACEvB,EAAUc,iBAAiBU,YAAYN,KAAKC,kCAI9CM,QAAS,CAEDN,gCAAN,SAAuCd,6EACrCa,KAAKb,UAAYqB,OAAOC,OAAOT,KAAKb,UAAWA,iBAKxCuB,EAAuBjB,UAAKC,OAAO,CAC9CiB,wBAEE3B,EAAUgB,KAAKY,SAGXC,0BAAkBC,EAAIC,EAAMC,0GAC5BF,EAAGG,QAAQC,MAAK,SAAAC,GAAU,OAAAA,EAAOC,KAAKC,iBAExCpC,EAAqB6B,EAAGQ,SAIxBxC,EAAUc,iBAAiBG,UAAUb,MAGPJ,EAAUM,wCAAhBE,gBAEhBH,EAAYL,EAAUc,iBAAiBC,kBACvCX,EAAiBC,mBAAvBG,sBAEA0B,wCAGFA,uCAGJO,0BAAkBT,EAAIC,EAAMC,GAC1BlC,EAAUc,iBAAiBU,YAAYpB,GACvC8B,aAqCW,CAAEQ,QAjCjB,SAAkBC,EAAkBnC,GAApC,WAAoCoC,aAGhC,KAFFC,aACAC,mBAEA,IAAKD,EACH,MAAM,IAAIE,eAAa,2CAIzBF,EAASG,UAAe,wBAAmCH,EAASG,UAG/DH,EAASI,QAAQC,qBACpBL,EAASI,QAAQC,mBAAqB,SAAOL,EAAoBM,yEAE/D,OAAIjD,GACIkD,EAAOC,gBAAcF,EAAaG,OAAOC,SAASC,QACxDtD,EAAQuD,QAAQ,CAAEL,0BAMxBpD,EAAY6C,EACZ5C,EAAkB6C,EAElBH,EAAIe,MAAMhD,GACViC,EAAIe,MAAM9B,GAGVe,EAAIgB,UAAUC,UAAYf,MCjHbF,UAAI/B,OAAO,CACxBiD,KAAM,gBACAC,iHACJ,SAAM5C,KAAK0C,UAAUG,qCAArBvD,qBAEFwD,OAAA,WAGE,OAAO9C,KAAK+C,aAAaC,SAAWhD,KAAK+C,aAAaC,QAAQ"}